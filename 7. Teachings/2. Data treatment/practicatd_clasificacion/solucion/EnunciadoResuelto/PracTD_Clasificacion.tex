\documentclass[11pt,a4paper]{article}

\usepackage{epsfig}
\usepackage[OT1]{fontenc}
\usepackage[latin1]{inputenc}
\usepackage[spanish]{babel}
\usepackage{amsmath,amssymb}
\usepackage{float}

\oddsidemargin  -0.31in
\evensidemargin -0.31in

\topmargin 50truept
\headheight 0truept
\headsep 0truept
\voffset -20truemm
%\footheight 0truept
\footskip 10truemm
\textheight 250truemm
\textwidth 175truemm

%\twocolumn
%\columnsep 8truemm
\pagestyle{empty}

\setlength{\parindent}{0pt}
\setlength{\parskip}{10pt}


\def\bfmath#1{\mbox{\boldmath$#1$}} 
\begin{document}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\title{Práctica 1: Clasificación}

%%% IEEE
\author{Tratamiento de Datos\\ Curso 2013--2014 }
\maketitle

\section*{Introducción}
\label{sec-intro}

En esta práctica analizaremos los métodos de regresion logística y las máquinas de vectores soporte utilizando datos generados artificialmente. A continuación, analizaremos el comportamiento de estos clasificadores utilizando una base de datos reales.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Análisis de un problema sintético bidimensional}

Cargue los datos contenidos en el fichero {\tt 'datosP1.mat'}. El fichero contiene dos variables, {\tt x} e {\tt y}. La primera es una matriz de observaciones. Cada fila de la matriz es una observación bidimensional. La segunda contiene la categoría a la que pertenece cada observación (0 ó 1).



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Regresión logística: clasificador lineal}

En primer lugar, analizaremos el comportamiento de un modelo de regresión logística.

\begin{enumerate}
\item Visualice las observaciones sobre el plano, utilizando un marcador diferente para los datos de cada categoría.


\begin{figure}[htpb]
\centering
	\includegraphics[width=0.48\textwidth]{./figuras/figura1.eps} 
	\caption{Datos de entrenamiento}		
	\label{fig1}
\end{figure}


\item Utilizando la función {\tt glmfit}, ajuste un modelo de regresión logística a los datos.

\begin{verbatim} 
w =
    1.5003
   -2.4573
    0.1496
\end{verbatim}

\item Utilizando la función {\tt contourf}, visualice el mapa de probabilidades a posteriori estimadas para la categoría 1.
\begin{figure}[htpb]
\centering
	\includegraphics[width=0.48\textwidth]{./figuras/figura2.eps} 
	\caption{Probabilidad a posteriori}			
	\label{fig2}
\end{figure}

\item Determine las tasas de error de entrenamiento y validación.
\begin{verbatim} 
Error rates:
eTrain =
    0.2975
eVal =
    0.3525
\end{verbatim}

\item Determine las verosimilitud de los datos de entrenamiento y test para el modelo obtenido.
\begin{verbatim} 
Likelihoods for training and test data:
lTrain =
  250.0087
lTest =
  239.3246
\end{verbatim}

\end{enumerate}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Regresión logística: clasificador no lineal}

A continuación, analizaremos el comportamiento de un clasificador no lineal basado en un modelo de regresión logística con términos polinómicos.

\begin{enumerate}
\item Utilizando la función {\tt glmfit}, ajuste un modelo de regresión logística con términos polinómicos de grado 1, 2 y 3 a los datos.
\begin{verbatim} 
w2 =
   -0.5516
   11.4479
   -5.7585
   -8.0336
  -14.2474
   13.5061
   
   
w2 =
    1.0855
   -1.4407
  -16.5035
   42.6038
  -42.7352
   55.5733
  -34.9939
   -7.4124
   34.3358
  -37.8443

\end{verbatim}

\item Utilizando la función {\tt contourf}, visualice el mapa de probabilidades a posteriori estimadas para la categoría 1.
\begin{figure}[htpb]
\centering
	\includegraphics[width=0.38\textwidth]{./figuras/figura3.eps} 	
	\includegraphics[width=0.38\textwidth]{./figuras/figura4.eps} 	
	\includegraphics[width=0.38\textwidth]{./figuras/figura5.eps} 
	\caption{Probabilidad a posteriori con modelos de regresión logística con términos polinómicos de grado 1 (primera fila izda), 2 (primera fila dcha) y 3 (segunda fila) a los datos.}	
		\label{fig3}		
\end{figure}



\item Calcule las tasas de error de entrenamiento y validación.

\begin{verbatim} 
Training and validation error rates for d=1:
eTrain =
    0.2975
eVal =
    0.3525

Training, validation and test error rates for d=2:
eTrain =
    0.2325
eVal =
    0.2625
    
    
Training and validation error rates  for d=3:
eTrain =
    0.2075
eTest =
    0.2275    
    
    

\end{verbatim}

\item Calcule las verosimilitud de los datos de entrenamiento y test para el modelo obtenido.

\begin{verbatim} 
Likelihoods for training and test data for d=1:
lTrain =
  250.0087
lTest =
  239.3246

Likelihoods for training and test data for d=2:
lTrain =
  189.2652
lTest =
  171.9362
  
Likelihoods for training and test data  for d=3:
lTrain =
  173.5047
lTest =
  171.3453
\end{verbatim}


\end{enumerate}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Máquina de vectores soporte}

Evaluaremos a continuación las prestaciones de un clasificador basado en máquinas de vectores soporte (SVM, {\em Support Vector Machine}).

Utilizaremos, para ello, una SVM con núcleos gaussianos de desviación típica 0.5.

\begin{enumerate}
\item Utilizando la función {\tt svmtrain}, entrene una SVM con los datos de entrenamiento, visualizando la frontera de decisión, tomando $C=$ 0.1. (N\'otese que s\'olo se puede visualizar la frontera de decisión de forma autom\'atica usando la funci\'on svmtrain del statistic toolbox, no con el uso de la funci\'on de svmtrain de las librer\'ias provistas).

El comando para usar la funci\'on svmtrain del statistic toolbox es la siguiente:
\begin{verbatim}
figure
svmStruct0 = svmtrain(xTrain,yTrain,     'kernel_function','rbf',...
                      'rbf_sigma',sigma, 'showplot','true',...
                      'boxconstraint',C, 'method','LS');
dVal   = svmclassify(svmStruct0,xVal,  'showplot',false);
dTrain = svmclassify(svmStruct0,xTrain,'showplot',false);
\end{verbatim}
y se obtienen los siguientes errores
\begin{verbatim}
eTrain =
    0.2200
eVal =
    0.2950
\end{verbatim}


El comando para usar la funci\'on svmtrain de las librer\'ias provistas es la siguiente:

\begin{verbatim}
svmStruct0 = svmtrain(yTrain+1,xTrain, ['-t 2 -c ' num2str(C) ' -g ' num2str(1/sigma)]);     
[dVal, accuracyVal] = svmpredict(yVal+1, xVal, svmStruct0);     
\end{verbatim}
{\bf n\'otese que como la tercera variable de entrada es una cadena de texto, hay que dejar espacios entre las opciones elegidas}.

\begin{figure}[htpb]
\centering
	\includegraphics[width=0.48\textwidth]{./figuras/figura6.eps} 	
	\caption{Datos de entrenamiento (cruces rojas y verdes), frontera de decisi\'on (l\'inea negra) y vectores soporte (c\'irculos negros)}			
	\label{fig4}
\end{figure}

\item Haciendo un barrido sobre el parámetro $C$, visualice las tasas de error de entrenamiento y validación, en función de $C$, y elija un valor de acuerdo con el error de validación. (Resultados correspondientes a un barrido de C \begin{verbatim} C  = 10.^(-4:0.1:2); \end{verbatim})


\begin{figure}[htpb]
\centering
	\includegraphics[width=0.58\textwidth]{./figuras/figura7.eps}
	\caption{Tasas de error de entrenamiento (azul) y validaci\'on (verde).}			 	
	\label{fig5}
\end{figure}

\begin{figure}[htpb]
\centering
	\includegraphics[width=0.58\textwidth]{./figuras/figura8.eps} 	
	\caption{Tasas de error de entrenamiento y validaci\'on con $C$ en escala logar\'itmica para mejor visualizaci\'on.}			 	
	\label{fig6}
\end{figure}


\end{enumerate}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Evaluación final}

Seleccione, de acuerdo con las tasas de error de validación, el clasificador que mejores prestaciones ha obtenido, de entre todos los analizados en las secciones anteriores, y determine su tasa de error con los datos de test.

\begin{verbatim}
[eMin,iMin] = min(eVal);
 C(iMin)
ans =
    0.0631
\end{verbatim}
Usando el clasificado que mejores prestaciones ha obtenido en error de validaci\'on se error de test es
\begin{verbatim}
eTest =
    0.2375
\end{verbatim}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Clasificación con datos reales}

Aplicaremos en esta sección los clasificadores anteriores a una base de datos reales multidimensionales. La visualización de los datos en el espacio de entrada ya no es posible, pero podemos evaluar las prestaciones utilizando las tasas de error.

Trabajaremos con el {\tt cancer\_dataset}.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Preparación de datos}

Antes de entrenar el clasificador, conviene normalizarlos, para que la escala de todas las variables sea similar. 

Las siguientes líneas de código realizan una transformación lineal que hace que los datos de entrenamiento tengan media nula y varianza unidad. Exactamente la misma transformación ha de aplicarse a los datos de validación y de test:

{\tt mx = mean(xTrain); stdx = std(xTrain);}  \\
{\tt xTrain = (xTrain - ones(nTrain,1)*mx)./(ones(nTrain, 1)*stdx);} \\ 
{\tt xVal   = (xVal   - ones(nVal,1)*mx)./(ones(nVal,1)*stdx); }     \\
{\tt xTest  = (xTest  - ones(nTest,1)*mx)./(ones(nTest,1)*stdx);}

Realizaremos todo el resto de la práctica con los datos normalizados.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Clasificación con máquinas de vectores soporte}

En este apartado entrenaremos una máquina de vectores soporte con núcleos gaussianos. Utilizaremos el conjunto de validación para determinar los valores de los hiperparámetros $sigma$ y $C$.


\begin{enumerate}
\item Entrene la SVM para diferentes valores de $\sigma$ entre -0.02 y 8 y valores de $C$ entre 0.001 y 1000. Determine las tasas de error de entrenamiento y validación en cada caso, y represente gráficamente (por ejemplo, mediante la función {\tt contourf}), dichas tasas de error.

\begin{figure}[htpb]
\centering
	\includegraphics[width=0.48\textwidth]{./figuras/figura9.eps} 	

	\caption{Resultados de error con datos de entrenamiento para diferentes valores de $\sigma$ entre -0.02 y 8 y valores de $C$ entre 0.001 y 1000.}
	\label{fig9}
\end{figure}

\begin{figure}[htpb]
\centering
	\includegraphics[width=0.48\textwidth]{./figuras/figura10.eps} 	

	\caption{Resultados de error con datos de validaci\'on para diferentes valores de $\sigma$ entre -0.02 y 8 y valores de $C$ entre 0.001 y 1000.}
	\label{fig10}
\end{figure}



\item Determine los valores de anchura del núcleo, $\sigma$, y del parámetro $C$ que minimizan la tasa de error de validación.

\begin{verbatim}
sigma(jMin)
ans =
    1.4500
K>> C(kMin)
ans =
    0.4467
\end{verbatim}


\item Evalúe las prestaciones del clasificador utilizando los datos de test, para los valores de los hiperparámetros seleccionados en el apartado anterior.

Usando los los valores de C y sigma que minimizan el error de validaci\'on, se clasifica nuevamente obteniendo un error de test de 
\begin{verbatim}
eTest =
    0.0258
\end{verbatim}




\end{enumerate}





\end{document}


